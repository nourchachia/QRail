<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÑ Neural Rail Conductor - Network Operations Center</title>

    <!-- External Libraries (CDN) -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/network-view.css">
    <link rel="stylesheet" href="css/timeline.css">
    <link rel="stylesheet" href="css/control-panel.css">
</head>

<body>
    <!-- Global Error Handler for Debugging -->
    <script>
        window.onerror = function (msg, url, line) {
            const errorBox = document.createElement('div');
            errorBox.style.cssText = 'position:fixed;top:0;left:0;width:100%;background:red;color:white;padding:10px;z-index:9999;font-family:monospace;';
            errorBox.textContent = `‚ùå Error: ${msg} (Line ${line})`;
            document.body.appendChild(errorBox);
            return false;
        };
    </script>
    <div class="app">
        <!-- Header -->
        <header class="app-header">
            <h1>üöÑ Neural Rail Conductor</h1>
            <span class="subtitle">Network Operations Center</span>
            <div class="clock-display" id="app-clock"
                style="font-family: monospace; font-size: 1.2rem; color: #3b82f6; margin-left: 20px; font-weight: bold;">
                --:--:--</div>
            <div class="demo-controls">
                <button id="demo-mode-toggle" class="toggle-btn">
                    <span class="toggle-icon">üé¨</span> Demo Mode: <span id="demo-mode-status">OFF</span>
                </button>
                <button id="reset-btn" class="reset-btn">‚Üª Reset</button>
            </div>
        </header>

        <!-- Main 3-Panel Layout -->
        <main class="app-main">
            <!-- LEFT: Network View -->
            <div class="panel network-panel">
                <div id="network-view" class="network-view">
                    <svg id="network-svg"></svg>
                    <div class="network-status">
                        <span id="weather-status">üå¶Ô∏è Weather: Loading...</span>
                        <span id="load-status">üìä Load: --%</span>
                        <span id="trains-status">üöÇ Trains: --</span>
                    </div>
                </div>
            </div>

            <!-- CENTER: Timeline -->
            <div class="panel timeline-panel">
                <div id="timeline" class="timeline">
                    <h2>Cascade Timeline</h2>

                    <!-- Metrics Summary -->
                    <div id="metrics-summary" class="metrics-summary">
                        <div class="metric-box">
                            <div class="metric-icon">üå¶Ô∏è</div>
                            <div class="metric-content">
                                <div class="metric-label">Weather</div>
                                <div class="metric-value" id="weather-value">--</div>
                            </div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-icon">üìä</div>
                            <div class="metric-content">
                                <div class="metric-label">Network Load</div>
                                <div class="metric-value" id="load-value">--%</div>
                            </div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-icon">üöÇ</div>
                            <div class="metric-content">
                                <div class="metric-label">Active Trains</div>
                                <div class="metric-value" id="trains-value">--</div>
                            </div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-icon">‚ö†Ô∏è</div>
                            <div class="metric-content">
                                <div class="metric-label">Incidents</div>
                                <div class="metric-value" id="incidents-value">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- Telemetry Chart -->
                    <div class="telemetry-section">
                        <h3>Last 30 Minutes</h3>
                        <canvas id="telemetry-chart"></canvas>
                    </div>

                    <!-- Comparison View (Before/After) -->
                    <div id="comparison-view" class="comparison-view hidden">
                        <h3>Impact Analysis</h3>

                        <div class="comparison-metrics">
                            <div class="metric-card without-ai">
                                <div class="metric-header">‚ùå Without AI</div>
                                <div class="metric-value" id="delay-without">-- min</div>
                                <div class="metric-details">
                                    <div id="trains-without">-- trains</div>
                                    <div id="passengers-without">-- passengers</div>
                                </div>
                            </div>
                            <div class="metric-card with-ai">
                                <div class="metric-header">‚úÖ With AI</div>
                                <div class="metric-value success" id="delay-with">-- min</div>
                                <div class="metric-details">
                                    <div id="trains-with">-- trains</div>
                                    <div id="passengers-with">-- passengers</div>
                                </div>
                            </div>
                        </div>

                        <div class="savings-banner">
                            <div class="savings-item">
                                <div class="savings-icon">‚è±Ô∏è</div>
                                <div class="savings-content">
                                    <div class="savings-value" id="time-saved">-- min</div>
                                    <div class="savings-label">Time Saved</div>
                                </div>
                            </div>
                            <div class="savings-item">
                                <div class="savings-icon">üìà</div>
                                <div class="savings-content">
                                    <div class="savings-value" id="improvement-pct">--%</div>
                                    <div class="savings-label">Improvement</div>
                                </div>
                            </div>
                            <div class="savings-item">
                                <div class="savings-icon">üë•</div>
                                <div class="savings-content">
                                    <div class="savings-value" id="passengers-saved">--</div>
                                    <div class="savings-label">Fewer Affected</div>
                                </div>
                            </div>
                        </div>

                        <canvas id="comparison-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- RIGHT: Control Panel -->
            <div class="panel control-panel-container">
                <div id="control-panel" class="control-panel">
                    <!-- Incident Input -->
                    <div class="incident-input-section">
                        <h3>Report Incident</h3>
                        <textarea id="incident-text" rows="5" placeholder="Describe what's happening...

Examples:
‚Ä¢ Signal failure at Central Station, heavy rain
‚Ä¢ Train breakdown between North and South Junction
‚Ä¢ Power outage affecting western zone"></textarea>
                        <button id="analyze-btn" class="analyze-btn">
                            üîç Analyze Incident
                        </button>
                    </div>

                    <!-- Time Selector & Simulation Controls -->
                    <div class="time-selector-panel">
                        <h3>üïê Simulation Time</h3>
                        <div class="sim-clock-display">
                            <span class="clock-label">Current Time:</span>
                            <span id="sim-clock" class="sim-clock">--:--</span>
                        </div>
                        <div class="time-buttons">
                            <button class="time-btn" data-time="08:00">8 AM<br><span
                                    style="font-size:0.8em">Peak</span></button>
                            <button class="time-btn" data-time="12:00">12 PM<br><span
                                    style="font-size:0.8em">Midday</span></button>
                            <button class="time-btn" data-time="17:00">5 PM<br><span
                                    style="font-size:0.8em">Peak</span></button>
                            <button class="time-btn" data-time="20:00">8 PM<br><span
                                    style="font-size:0.8em">Quiet</span></button>
                        </div>
                        <div class="playback-controls">
                            <button id="play-pause-btn" class="play-pause-btn">‚ñ∂ Play</button>
                            <div class="speed-controls">
                                <span class="speed-label">Speed:</span>
                                <button class="speed-btn active" data-speed="1">1x</button>
                                <button class="speed-btn" data-speed="2">2x</button>
                                <button class="speed-btn" data-speed="4">4x</button>
                            </div>
                        </div>
                        <div class="day-type-selector">
                            <span class="day-label">Schedule:</span>
                            <button class="day-type-btn active" data-day="weekday">üìÖ Weekday</button>
                            <button class="day-type-btn" data-day="weekend">üèñÔ∏è Weekend</button>
                            <button class="day-type-btn" data-day="holiday">üéÑ Holiday</button>
                        </div>
                    </div>

                    <!-- Quick Scenario Buttons -->
                    <div class="quick-scenarios">
                        <h3>Quick Scenarios</h3>
                        <div class="scenario-buttons">
                            <button class="scenario-btn" data-scenario="signal_failure">
                                üö• Signal Failure
                            </button>
                            <button class="scenario-btn" data-scenario="train_breakdown">
                                ‚ö†Ô∏è Train Breakdown
                            </button>
                            <button class="scenario-btn" data-scenario="power_outage">
                                ‚ö° Power Outage
                            </button>
                        </div>
                    </div>

                    <!-- Search Status (Animated) -->
                    <div id="search-status" class="search-status hidden">
                        <div class="status-header">
                            <span class="brain-icon">üß†</span>
                            <span class="status-title">ANALYZING INCIDENT</span>
                        </div>
                        <ul class="step-list">
                            <li class="step-item" data-step="topology">
                                <span class="step-icon">‚óã</span>
                                <span class="step-label">Encoding network topology</span>
                            </li>
                            <li class="step-item" data-step="cascade">
                                <span class="step-icon">‚óã</span>
                                <span class="step-label">Analyzing cascade pattern</span>
                            </li>
                            <li class="step-item" data-step="context">
                                <span class="step-icon">‚óã</span>
                                <span class="step-label">Searching historical memory</span>
                            </li>
                        </ul>
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                        <p class="status-message" id="status-message">
                            Encoding current situation...
                        </p>
                    </div>

                    <!-- Similar Cases -->
                    <div id="similar-cases" class="similar-cases hidden"></div>

                    <!-- Resolution Options -->
                    <div id="resolution-options" class="resolution-options hidden"></div>

                    <!-- Feedback Form -->
                    <div id="feedback-form" class="feedback-form hidden">
                        <h3>Rate This Resolution</h3>
                        <p class="feedback-subtitle">Help the AI learn and improve</p>
                        <div class="rating-stars" id="rating-stars">
                            <button class="star" data-rating="1">‚òÜ</button>
                            <button class="star" data-rating="2">‚òÜ</button>
                            <button class="star" data-rating="3">‚òÜ</button>
                            <button class="star" data-rating="4">‚òÜ</button>
                            <button class="star" data-rating="5">‚òÜ</button>
                        </div>
                        <div class="rating-label" id="rating-label">Click to rate</div>
                        <textarea id="feedback-notes" rows="3" placeholder="Additional notes (optional)..."></textarea>
                        <button id="submit-feedback-btn" class="submit-feedback-btn" disabled>
                            Submit Feedback
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/static-data.js"></script>
    <script src="js/api.js"></script>
    <script src="js/state.js"></script>
    <script src="js/network-view.js"></script>
    <script src="js/timeline.js"></script>
    <script src="js/control-panel.js"></script>
    <script src="js/simulation-engine.js"></script>
    <script src="js/timetable-engine.js"></script>
    <script src="js/app.js"></script>
</body>

</html>